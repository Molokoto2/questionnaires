<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Résultats des Questionnaires</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>Résultats des Questionnaires</h1>
    </header>
    <main>
        <section id="results">
            <h2>Résultats par Questionnaire</h2>
            <div id="results-container"></div>
        </section>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Récupérer les réponses et les questionnaires depuis localStorage
        const responses = JSON.parse(localStorage.getItem('responses')) || {};
        const questionnaires = JSON.parse(localStorage.getItem('questionnaires')) || [];

        const container = document.getElementById('results-container');
        
        // Parcourir chaque questionnaire pour afficher ses résultats
        questionnaires.forEach((questionnaire) => {
            const questionnaireName = questionnaire.name;
            const responsesForQuestionnaire = responses[questionnaireName] || [];

            const section = document.createElement('section');
            section.innerHTML = `<h3>${questionnaireName}</h3>`;

            // Afficher les résultats sous forme de tableau
            const table = document.createElement('table');
            table.border = '1';
            const headers = ['Réponse #', ...questionnaire.questions.map(q => q.question)];
            table.innerHTML = `
                <thead>
                    <tr>${headers.map(h => `<th>${h}</th>`).join('')}</tr>
                </thead>
                <tbody>
                    ${responsesForQuestionnaire.map((r, i) => `
                        <tr>
                            <td>${i + 1}</td>
                            ${r.map(answer => `<td>${answer.response}</td>`).join('')}
                        </tr>
                    `).join('')}
                </tbody>
            `;
            section.appendChild(table);

            // Générer les graphiques en camembert pour chaque question
            questionnaire.questions.forEach((q, index) => {
                const data = responsesForQuestionnaire.map(r => r[index]?.response);
                const counts = q.responses.reduce((acc, res) => {
                    acc[res] = data.filter(d => d === res).length;
                    return acc;
                }, {});

                const canvas = document.createElement('canvas');
                section.appendChild(canvas);

                new Chart(canvas, {
                    type: 'pie',
                    data: {
                        labels: Object.keys(counts),
                        datasets: [{
                            label: `Répartition des réponses : ${q.question}`,
                            data: Object.values(counts),
                            backgroundColor: ['#007BFF', '#28A745', '#DC3545', '#FFC107', '#6C757D'],
                        }]
                    }
                });
            });

            container.appendChild(section);
        });
    </script>
</body>
</html>
